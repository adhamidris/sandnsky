{% load static %}
{% if gallery_section.items %}
<section id="gallery" class="galo bg-secondary/30 py-20 sm:px-6 lg:px-8">
  <div class="mx-auto max-w-7xl">
    <div class="desti2 px-0">
      <div class="desti mb-12 flex justify-center text-center">
        <div class="space-y-3 max-w-3xl">
          <div class="gal-mob">
            <p class="animated-section-label text-xs font-semibold uppercase tracking-[0.3em] text-primary">
              Gallery
            </p>
            <h2 class="font-serif text-3xl text-foreground sm:text-4xl">
              {{ gallery_section.title }}
            </h2>
          </div>
  
          <p class="px-4 max-w-2xl mx-auto text-sm leading-relaxed text-muted-foreground sm:text-base">
            {{ gallery_section.subtitle }}
          </p>
        </div>
      </div>
    </div>


    {% if gallery_section.background_image %}
      {% if gallery_section.background_image_is_media %}
      <div class="gallery-frame" style="--gallery-frame-bg: url('{{ gallery_section.background_image }}');">
      {% else %}
      <div class="gallery-frame" style="--gallery-frame-bg: url('{% static gallery_section.background_image %}');">
      {% endif %}
    {% else %}
      <div class="gallery-frame">
    {% endif %}

        <div class="gallery-band">

          <div class="symbols-marquee symbols-marquee--top" aria-hidden="true"></div>

          <div class="gallery-frame__inner">

          {% for row in gallery_section.rows %}
          {% if row %}
          <div
            class="gali gallery-marquee-row gallery-row relative overflow-hidden bg-secondary/20 py-4"
            data-marquee
            data-marquee-direction="{% if forloop.counter|divisibleby:2 %}reverse{% else %}forward{% endif %}"
            data-marquee-size="{% if forloop.counter == 1 %}large{% else %}regular{% endif %}"
          >
            <div class="flex items-center" data-marquee-wrapper>
              <div data-marquee-track>
                {% for item in row %}
                <figure class="flex shrink-0 flex-col gap-3" data-marquee-card>
                  <button type="button" class="card-Lframe group block overflow-hidden rounded-xl border border-border/40 bg-card" data-gallery-open data-gallery-src="{{ item.image_url }}" data-gallery-alt="{{ item.alt }}" data-gallery-caption="{{ item.caption|default:item.destination }}">
                    <img src="{{ item.image_url }}" alt="{{ item.alt }}" class="w-full object-cover transition-transform duration-500 group-hover:scale-105" data-marquee-image loading="lazy" />
                  </button>
                  <figcaption class="text-sm text-muted-foreground">
                    {{ item.caption|default:item.destination }}
                  </figcaption>
                </figure>
                {% endfor %}
              </div>
            </div>
          </div>
          {% endif %}
          {% endfor %}

          </div>

          <div class="symbols-marquee symbols-marquee--bottom" aria-hidden="true"></div>

        </div>

      </div>
    </div>
  </div>
</section>

{% block script %}
<style>

  .galo {
    background-color: #EBE2D3;
  }

html, body { overflow-x: clip; }  /* or hidden if you need wider support */


  .fullbleed {
    width: 100vw;
    margin-left: calc(50% - 50vw);
    margin-right: calc(50% - 50vw);
  }
  /* ===== Symbols Marquee Strips (full-bleed, one above + one below) ===== */
  .symbols-marquee {
    display: block;
    height: clamp(2.75rem, 6vw, 3.75rem);
    width: 100vw;
    margin-top: 0;
    margin-bottom: 0;
    padding: 0;
    margin-left: calc(50% - 50vw);
    margin-right: calc(50% - 50vw);

    background-image: url('/media/symbolsfinal.png');
    background-repeat: repeat-x;
    background-position: 0 50%;
    background-size: auto 100%;
    overflow: hidden;
  }

  @keyframes symbols-scroll-left {
    from { background-position-x: 0; }
    to   { background-position-x: -1200px; }
  }
  @keyframes symbols-scroll-right {
    from { background-position-x: 0; }
    to   { background-position-x: 1200px; }
  }
  .symbols-marquee--top    { animation: symbols-scroll-left 28s linear infinite; }
  .symbols-marquee--bottom { animation: symbols-scroll-right 28s linear infinite; }

  @media (prefers-reduced-motion: reduce) {
    .symbols-marquee--top,
    .symbols-marquee--bottom {
      animation: none;
      background-position-x: 0;
    }
  }
  @media (max-width: 639px) {
  .symbols-marquee {
    height: clamp(2.5rem, 11vw, 3.5rem);
    width: 100vw;
    margin-left: calc(50% - 50vw);
    margin-right: calc(50% - 50vw);
    /* keep the rest as-is (bg, animation, etc.) */
  }
}

  /* ===== Frame styling ===== */
  .gallery-frame {
    position: relative;
    border-radius: 3rem;
    border: none;
    box-shadow: none;
    overflow: visible;
    --gallery-frame-bg: none;
  }

  .gallery-frame::before {
    content: "";
    position: absolute;
    inset: -12%;
    border-radius: inherit;
    background-image: var(--gallery-frame-bg);
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    opacity: 0.95;
    z-index: -2;
  }

  .gallery-frame::after {
    content: none;
  }

  .gallery-band {
    position: relative;
    width: 100vw;
    margin-left: calc(50% - 50vw);
    margin-right: calc(50% - 50vw);
    background-color: #EBE2D3;
    }

  .gallery-frame__inner {
    position: relative;
    border-radius: calc(3rem - 14px);
    padding: clamp(2.5rem, 4vw, 3.5rem);
    background: transparent;
    backdrop-filter: none;
    overflow: visible; /* allow full-bleed strips to extend */
  }

  .gallery-frame__inner::before {
    content: none;
  }

  /* ===== Marquee rows (keep spacing only between rows) ===== */
  .gallery-row + .gallery-row { margin-top: 0.75rem; }

  @media (max-width: 639px) {
    .gallery-band {
      width: 100vw;
      margin-left: calc(50% - 50vw);
      margin-right: calc(50% - 50vw);
      padding: clamp(1.25rem, 6vw, 2rem) 0;
    }
  }

  @media (max-width: 639px) {
    .gallery-marquee-row {
      width: 100vw;
      margin-left: calc(50% - 50vw);
      margin-right: calc(50% - 50vw);
    }
  }

  @media (min-width: 1024px) {
    .gallery-band {
      width: 100vw;
      margin-left: calc(50% - 50vw);
      margin-right: calc(50% - 50vw);
      padding: clamp(1.5rem, 3vw, 2.25rem) 0;
    }

    .gallery-marquee-row {
      width: 100vw;
      margin-left: calc(50% - 50vw);
      margin-right: calc(50% - 50vw);
    }
  }

  [data-marquee-wrapper] {
    display: flex;
    align-items: center;
  }

  [data-marquee-track] {
    display: inline-flex;
    flex-wrap: nowrap;
    flex-shrink: 0;
    gap: 2rem;
    will-change: transform;
    transform: translateX(0);
    transition: transform 0.2s ease-out;
  }

  [data-marquee][data-marquee-direction="reverse"] [data-marquee-track] {
    /* animation handled via JS */
  }

  [data-marquee-card] {
    width: 200px;
    flex-shrink: 0;
  }

  [data-marquee][data-marquee-size="regular"] [data-marquee-card] {
    width: 240px;
  }

  [data-marquee][data-marquee-size="large"] [data-marquee-card] {
    width: 320px;
  }

  [data-marquee-image] {
    height: 150px;
  }

  [data-marquee][data-marquee-size="regular"] [data-marquee-image] {
    height: 180px;
  }

  [data-marquee][data-marquee-size="large"] [data-marquee-image] {
    height: 220px;
  }

  [data-gallery-open] {
    cursor: zoom-in;
  }

  @media (min-width: 640px) {
    [data-marquee-card] {
      width: 220px;
    }
    [data-marquee-image] {
      height: 170px;
    }

    [data-marquee][data-marquee-size="regular"] [data-marquee-card] {
      width: 270px;
    }

    [data-marquee][data-marquee-size="regular"] [data-marquee-image] {
      height: 205px;
    }

    [data-marquee][data-marquee-size="large"] [data-marquee-card] {
      width: 360px;
    }
    [data-marquee][data-marquee-size="large"] [data-marquee-image] {
      height: 250px;
    }
  }

  @media (min-width: 1024px) {
    [data-marquee-card] {
      width: 240px;
    }
    [data-marquee-image] {
      height: 190px;
    }

    [data-marquee][data-marquee-size="regular"] [data-marquee-card] {
      width: 300px;
    }

    [data-marquee][data-marquee-size="regular"] [data-marquee-image] {
      height: 220px;
    }

    [data-marquee][data-marquee-size="large"] [data-marquee-card] {
      width: 400px;
    }
    [data-marquee][data-marquee-size="large"] [data-marquee-image] {
      height: 280px;
    }

  }

  /* ===== Minimal L-corner frame for gallery cards ===== */
.card-Lframe {
  position: relative;
  isolation: isolate;                 /* keep overlay above bg but under content if needed */
  border-radius: 0.75rem;             /* aligns with rounded-xl; tweak if you change radius */
  --l-color: color-mix(in srgb, var(--ph-ink, #3e2f22) 88%, #000 12%);
  --l-thick: 2px;                     /* 2px is crisper on retina than 1px */
  --l-len: 16px;                      /* arm length of the L */
  --l-inset: 10px;                    /* how far in from the edges */
  --l-opacity: 0.7;                   /* base visibility */
}

.card-Lframe::before {
  content: "";
  position: absolute;
  inset: var(--l-inset);
  border-radius: inherit;
  pointer-events: none;
  opacity: var(--l-opacity);
  transition: opacity .2s ease, transform .2s ease;

  /* Draw 8 tiny bars (2 per corner) as an L */
  background:
    /* top-left */     linear-gradient(var(--l-color), var(--l-color)) 0 0 / var(--l-len) var(--l-thick) no-repeat,
                       linear-gradient(var(--l-color), var(--l-color)) 0 0 / var(--l-thick) var(--l-len) no-repeat,
    /* top-right */    linear-gradient(var(--l-color), var(--l-color)) 100% 0 / var(--l-len) var(--l-thick) no-repeat,
                       linear-gradient(var(--l-color), var(--l-color)) 100% 0 / var(--l-thick) var(--l-len) no-repeat,
    /* bottom-left */  linear-gradient(var(--l-color), var(--l-color)) 0 100% / var(--l-len) var(--l-thick) no-repeat,
                       linear-gradient(var(--l-color), var(--l-color)) 0 100% / var(--l-thick) var(--l-len) no-repeat,
    /* bottom-right */ linear-gradient(var(--l-color), var(--l-color)) 100% 100% / var(--l-len) var(--l-thick) no-repeat,
                       linear-gradient(var(--l-color), var(--l-color)) 100% 100% / var(--l-thick) var(--l-len) no-repeat;
}

/* Nice little emphasis on hover/focus */
.card-Lframe:hover::before,
.card-Lframe:focus-visible::before {
  opacity: 0.95;
  transform: translateZ(0); /* prevents blurring on some GPUs */
}

/* Optional: tighter corners on small cards */
@media (max-width: 640px) {
  .card-Lframe {
    --l-len: 12px;
    --l-inset: 8px;
  }
}

@media (max-width: 768px) {
  .gal-mob {
    background-image: url('media/galleryheadfinal1.svg');
    background-repeat: no-repeat;
    background-position: center;
    background-size: fill;
  }
}


</style>
{% endblock %}
<div class="fixed inset-0 z-50 hidden items-center justify-center bg-black/80 p-6" data-gallery-modal aria-hidden="true" role="dialog" aria-modal="true">
  <div class="relative max-w-4xl w-full">
    <button type="button" class="absolute right-4 top-4 inline-flex h-10 w-10 items-center justify-center rounded-full bg-black/60 text-white transition-colors hover:bg-black/80" data-gallery-close aria-label="Close gallery">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" class="h-5 w-5">
        <path stroke-linecap="round" stroke-linejoin="round" d="M6 6l12 12M18 6 6 18" />
      </svg>
    </button>
    <figure class="overflow-hidden rounded-3xl bg-black/40 shadow-2xl">
      <img src="" alt="" class="max-h-[70vh] w-full object-contain" data-gallery-modal-image />
      <figcaption class="bg-black/70 px-6 py-4 text-sm text-white" data-gallery-modal-caption></figcaption>
    </figure>
  </div>
</div>

<script src="{% static 'js/gallery-marquee.js' %}"></script>
{% endif %}
