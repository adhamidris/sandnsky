{% load static %}
{% if gallery_section.items %}
<section id="gallery" class="bg-secondary/30 px-4 py-20 sm:px-6 lg:px-8">
  <div class="mx-auto max-w-7xl">
    <div class="mb-12 flex justify-center text-center">
      <div class="space-y-3 max-w-3xl">
        <p class="text-xs font-semibold uppercase tracking-[0.3em] text-primary">
          Gallery
        </p>
        <h2 class="font-serif text-3xl text-foreground sm:text-4xl">
          {{ gallery_section.title }}
        </h2>
        <p class="max-w-2xl mx-auto text-sm leading-relaxed text-muted-foreground sm:text-base">
          {{ gallery_section.subtitle }}
        </p>
      </div>
    </div>

    {% if gallery_section.background_image %}
      {% if gallery_section.background_image_is_media %}
      <div class="gallery-frame" style="--gallery-frame-bg: url('{{ gallery_section.background_image }}');">
      {% else %}
      <div class="gallery-frame" style="--gallery-frame-bg: url('{% static gallery_section.background_image %}');">
      {% endif %}
    {% else %}
      <div class="gallery-frame">
    {% endif %}

        <div class="gallery-decor gallery-decor--top" aria-hidden="true">
          <img src="/media/top.png" alt="" role="presentation" loading="lazy" />
        </div>

        <div class="gallery-frame__inner">

          <!-- symbols marquee (top) -->
          <div class="symbols-marquee symbols-marquee--top" aria-hidden="true"></div>

          {% for row in gallery_section.rows %}
          {% if row %}
          <div
            class="gallery-marquee-row gallery-row relative overflow-hidden bg-secondary/20 py-10 shadow-[0_18px_45px_rgba(17,24,39,0.18)]"
            data-marquee
            data-marquee-direction="{% if forloop.counter|divisibleby:2 %}reverse{% else %}forward{% endif %}"
            data-marquee-size="{% if forloop.counter == 1 %}large{% else %}regular{% endif %}"
          >
            <div class="pointer-events-none absolute inset-y-0 left-0 w-24 bg-gradient-to-r from-background via-background/70 to-transparent"></div>
            <div class="pointer-events-none absolute inset-y-0 right-0 w-24 bg-gradient-to-l from-background via-background/70 to-transparent"></div>

            <div class="flex items-center" data-marquee-wrapper>
              <div data-marquee-track>
                {% for item in row %}
                <figure class="flex shrink-0 flex-col gap-3" data-marquee-card>
                  <button type="button" class="group block overflow-hidden rounded-xl border border-border/40 bg-card shadow-[0_18px_45px_rgba(17,24,39,0.18)] transition-shadow duration-300 hover:shadow-[0_20px_50px_rgba(17,24,39,0.24)]" data-gallery-open data-gallery-src="{{ item.image_url }}" data-gallery-alt="{{ item.alt }}" data-gallery-caption="{{ item.caption|default:item.destination }}">
                    <img src="{{ item.image_url }}" alt="{{ item.alt }}" class="w-full object-cover transition-transform duration-500 group-hover:scale-105" data-marquee-image loading="lazy" />
                  </button>
                  <figcaption class="text-sm text-muted-foreground">
                    {{ item.caption|default:item.destination }}
                  </figcaption>
                </figure>
                {% endfor %}
              </div>
            </div>
          </div>
          {% endif %}
          {% endfor %}

          <!-- symbols marquee (bottom) -->
          <div class="symbols-marquee symbols-marquee--bottom" aria-hidden="true"></div>

        </div>

        <div class="gallery-decor gallery-decor--bottom" aria-hidden="true">
          <img src="/media/bottom.png" alt="" role="presentation" loading="lazy" />
        </div>
      </div>
    </div>
  </div>
</section>

<style>
  /* ===== Symbols Marquee Strips (full-bleed, one above + one below) ===== */
  .symbols-marquee {
    display: block;
    height: 56px;               /* larger strip */
    width: 100vw;               /* full viewport width */
    margin: 0;
    /* center the 100vw inside the inner container so it reaches screen edges */
    margin-left: calc(50% - 50vw);
    margin-right: calc(50% - 50vw);

    background-image: url('/media/symbolsfinal.png');
    background-repeat: repeat-x;
    background-position: 0 50%;
    background-size: auto 100%;
    border-radius: 0;           /* flush edges */
  }

  @keyframes symbols-scroll-left {
    from { background-position-x: 0; }
    to   { background-position-x: -1200px; }
  }
  @keyframes symbols-scroll-right {
    from { background-position-x: 0; }
    to   { background-position-x: 1200px; }
  }
  .symbols-marquee--top    { animation: symbols-scroll-left 28s linear infinite; }
  .symbols-marquee--bottom { animation: symbols-scroll-right 28s linear infinite; }

  @media (prefers-reduced-motion: reduce) {
    .symbols-marquee--top,
    .symbols-marquee--bottom {
      animation: none;
      background-position-x: 0;
    }
  }
  @media (max-width: 639px) {
    .symbols-marquee { height: 48px; }
  }

  /* ===== Frame + decor (unchanged except overflow visible) ===== */
  .gallery-frame {
    position: relative;
    border-radius: 3rem;
    border: none;
    box-shadow: none;
    overflow: visible;
    --gallery-frame-bg: none;
  }

  .gallery-frame::before {
    content: "";
    position: absolute;
    inset: -12%;
    border-radius: inherit;
    background-image: var(--gallery-frame-bg);
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    opacity: 0.95;
    z-index: -2;
  }

  .gallery-frame::after {
    content: "";
    position: absolute;
    inset: 0;
    border-radius: inherit;
    background: linear-gradient(125deg, rgba(255, 255, 255, 0.12), rgba(255, 255, 255, 0));
    z-index: -1;
    pointer-events: none;
  }

  .gallery-frame__inner {
    position: relative;
    border-radius: calc(3rem - 14px);
    padding: clamp(2.5rem, 4vw, 3.5rem);
    background: transparent;
    backdrop-filter: none;
    overflow: visible; /* allow full-bleed strips to extend */
  }

  .gallery-frame__inner::before {
    content: none;
  }

  .gallery-decor {
    width: min(100%, 72rem);
    margin-inline: auto;
    overflow: hidden;
  }

  .gallery-decor img {
    display: block;
    width: 100%;
  }

  .gallery-decor--top {
    margin-bottom: clamp(0.5rem, 2vw, 1rem);
  }

  .gallery-decor--bottom {
    margin-top: clamp(0.5rem, 2vw, 1rem);
  }

  /* ===== Marquee rows (keep spacing only between rows) ===== */
  .gallery-row + .gallery-row { margin-top: 2.5rem; }

  @media (max-width: 639px) {
    .gallery-decor {
      width: 140vw;
      margin-left: calc((140vw - 100%) / -2);
      margin-right: calc((140vw - 100%) / -2);
    }

    .gallery-decor img {
      width: 140vw;
      height: clamp(5rem, 20vw, 8rem);
      object-fit: cover;
    }

    .gallery-marquee-row {
      width: 100vw;
      margin-left: calc((100vw - 100%) / -2);
      margin-right: calc((100vw - 100%) / -2);
    }
  }

  @media (min-width: 1024px) {
    .gallery-decor {
      width: 100vw;
      margin-left: calc((100vw - 100%) / -2);
      margin-right: calc((100vw - 100%) / -2);
    }

    .gallery-decor img {
      width: 100vw;
    }
  }

  [data-marquee-wrapper] {
    display: flex;
    align-items: center;
  }

  [data-marquee-track] {
    display: inline-flex;
    flex-wrap: nowrap;
    flex-shrink: 0;
    gap: 2rem;
    will-change: transform;
    transform: translateX(0);
    transition: transform 0.2s ease-out;
  }

  [data-marquee][data-marquee-direction="reverse"] [data-marquee-track] {
    /* animation handled via JS */
  }

  [data-marquee-card] {
    width: 200px;
    flex-shrink: 0;
  }

  [data-marquee][data-marquee-size="large"] [data-marquee-card] {
    width: 320px;
  }

  [data-marquee-image] {
    height: 150px;
  }

  [data-marquee][data-marquee-size="large"] [data-marquee-image] {
    height: 220px;
  }

  [data-gallery-open] {
    cursor: zoom-in;
  }

  @media (min-width: 640px) {
    [data-marquee-card] {
      width: 220px;
    }
    [data-marquee-image] {
      height: 170px;
    }
    [data-marquee][data-marquee-size="large"] [data-marquee-card] {
      width: 360px;
    }
    [data-marquee][data-marquee-size="large"] [data-marquee-image] {
      height: 250px;
    }
  }

  @media (min-width: 1024px) {
    [data-marquee-card] {
      width: 240px;
    }
    [data-marquee-image] {
      height: 190px;
    }
    [data-marquee][data-marquee-size="large"] [data-marquee-card] {
      width: 400px;
    }
    [data-marquee][data-marquee-size="large"] [data-marquee-image] {
      height: 280px;
    }
  }
</style>

<div class="fixed inset-0 z-50 hidden items-center justify-center bg-black/80 p-6" data-gallery-modal aria-hidden="true" role="dialog" aria-modal="true">
  <div class="relative max-w-4xl w-full">
    <button type="button" class="absolute right-4 top-4 inline-flex h-10 w-10 items-center justify-center rounded-full bg-black/60 text-white transition-colors hover:bg-black/80" data-gallery-close aria-label="Close gallery">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" class="h-5 w-5">
        <path stroke-linecap="round" stroke-linejoin="round" d="M6 6l12 12M18 6 6 18" />
      </svg>
    </button>
    <figure class="overflow-hidden rounded-3xl bg-black/40 shadow-2xl">
      <img src="" alt="" class="max-h-[70vh] w-full object-contain" data-gallery-modal-image />
      <figcaption class="bg-black/70 px-6 py-4 text-sm text-white" data-gallery-modal-caption></figcaption>
    </figure>
  </div>
</div>

<script src="{% static 'js/gallery-marquee.js' %}"></script>
{% endif %}
