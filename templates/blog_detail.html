{% extends "base.html" %}
{% load static %}

{% block title %}{{ post.title }} — Journal — Kaya Tours{% endblock %}

{% block content %}
<article>
  <section class="relative isolate overflow-hidden">
    {% if post.hero_image_url %}
    <div class="absolute inset-0">
      <img src="{{ post.hero_image_url }}" alt="" class="h-full w-full object-cover" />
      <div class="absolute inset-0 bg-gradient-to-b from-black/60 via-black/40 to-black/70"></div>
    </div>
    {% else %}
    <div class="absolute inset-0 bg-gradient-to-br from-primary/20 via-secondary/25 to-background"></div>
    {% endif %}
    <div class="relative mx-auto max-w-4xl px-4 pb-24 pt-32 sm:px-6 lg:px-8">
      <div class="space-y-6 text-white">
        {% if post.category %}
        <span class="inline-flex items-center gap-2 rounded-full bg-white/15 px-4 py-1 text-xs font-semibold uppercase tracking-[0.2em]">{{ post.category }}</span>
        {% endif %}
        <div>
          <p class="text-sm uppercase tracking-[0.28em] text-white/70">
            {% if post.published_at %}{{ post.published_at|date:"F j, Y" }}{% endif %}
            {% if post.read_time_minutes %}
            <span class="mx-2 text-white/40">•</span>
            {{ post.read_time_minutes }} min read
            {% endif %}
          </p>
          <h1 class="mt-4 font-serif text-4xl leading-tight sm:text-5xl">{{ post.title }}</h1>
          {% if post.subtitle %}
          <p class="mt-4 text-base uppercase tracking-[0.24em] text-white/70">{{ post.subtitle }}</p>
          {% endif %}
        </div>
        {% if post.excerpt %}
        <p class="max-w-2xl text-base leading-relaxed text-white/75">{{ post.excerpt }}</p>
        {% endif %}
      </div>
    </div>
  </section>

  <section class="bg-background px-4 py-16 sm:px-6 lg:px-8">
    <div class="mx-auto max-w-3xl space-y-12">
      {% if post.intro_paragraphs %}
      <div class="space-y-6 text-base leading-relaxed text-muted-foreground">
        {% for paragraph in post.intro_paragraphs %}
        <p>{{ paragraph }}</p>
        {% endfor %}
      </div>
      {% endif %}

      {% if post.sections %}
      <div class="space-y-16">
        {% for section in post.sections %}
        <section id="section-{{ forloop.counter }}" class="space-y-8{% if forloop.first %} mt-12 sm:mt-16{% else %} mt-14 sm:mt-20{% endif %}">
          <div class="flex items-start gap-5">
            <span class="mt-1 text-xs font-semibold uppercase tracking-[0.32em] text-primary/80 leading-none">{{ forloop.counter|stringformat:"02d" }}</span>
            <div>
              <h2 class="font-serif text-3xl text-foreground">{{ section.heading }}</h2>
              {% if section.location %}
              <p class="mt-3 text-xs uppercase tracking-[0.28em] text-muted-foreground">{{ section.location }}</p>
              {% endif %}
            </div>
          </div>
          {% if section.image_url %}
          <div class="overflow-hidden rounded-3xl shadow-subtle">
            <img src="{{ section.image_url }}" alt="{{ section.heading }}" class="h-full w-full object-cover" />
          </div>
          {% endif %}
          {% if section.body_paragraphs %}
          <div class="space-y-6 text-base leading-relaxed text-muted-foreground">
            {% for paragraph in section.body_paragraphs %}
            <p>{{ paragraph }}</p>
            {% endfor %}
          </div>
          {% endif %}
        </section>
        {% endfor %}
      </div>
      {% endif %}
    </div>
  </section>

  {% if recommended_trips %}
  <section id="related-trips" class="bg-muted px-4 py-20 sm:px-6 lg:px-8">
    <div class="mx-auto max-w-7xl space-y-6">
      <div class="flex flex-col gap-4 text-left sm:flex-row sm:items-center sm:justify-between">
        <div class="space-y-2">
          <h2 class="font-serif text-3xl text-foreground sm:text-4xl">Explore our trips</h2>
          <p class="text-sm text-muted-foreground">Curated journeys that pair beautifully with this story.</p>
        </div>
        <a href="{% url 'web:trips' %}" class="inline-flex items-center gap-2 self-start rounded-full border border-transparent px-4 py-2 text-sm font-semibold text-primary transition-colors hover:text-primary/80 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-primary">
          <span>View all tours</span>
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" class="h-4 w-4">
            <path stroke-linecap="round" stroke-linejoin="round" d="m9 5 7 7-7 7" />
          </svg>
        </a>
      </div>
      <div class="grid gap-6 md:grid-cols-3">
        {% for trip in recommended_trips %}
        <article class="overflow-hidden rounded-xl border border-border bg-card shadow-sm">
          <a href="{% url 'web:trip-detail' trip.slug %}" class="flex h-full flex-col">
            {% if trip.image_url %}
            <img src="{{ trip.image_url }}" alt="{{ trip.title }}" class="h-48 w-full object-cover" />
            {% else %}
            <div class="flex h-48 w-full items-center justify-center bg-muted text-muted-foreground">
              <span class="text-xs font-semibold uppercase tracking-wide">Image coming soon</span>
            </div>
            {% endif %}
            <div class="flex flex-1 flex-col gap-3 p-4 text-sm">
              {% if trip.category %}
              <span class="text-xs uppercase tracking-wide text-muted-foreground">{{ trip.category }}</span>
              {% endif %}
              <h3 class="font-semibold text-foreground">{{ trip.title }}</h3>
              {% if trip.description %}
              <p class="text-muted-foreground">{{ trip.description }}</p>
              {% endif %}
              <div class="mt-auto flex items-center justify-between text-muted-foreground">
                <span>{{ trip.duration }}</span>
                <span class="font-semibold text-primary">
                  {{ trip.price }}
                  {% if trip.has_child_price and trip.child_price %}
                  <span class="block text-[11px] text-muted-foreground">Children: {{ trip.child_price }}</span>
                  {% endif %}
                </span>
              </div>
            </div>
          </a>
        </article>
        {% endfor %}
      </div>
    </div>
  </section>
  {% endif %}

  {% if related_posts %}
  <section id="related" class="bg-muted px-4 py-20 sm:px-6 lg:px-8">
    <div class="mx-auto max-w-7xl space-y-6">
      <div class="flex flex-col gap-4 text-left sm:flex-row sm:items-center sm:justify-between">
        <div class="space-y-2">
          <h2 class="font-serif text-3xl text-foreground sm:text-4xl">You may also like</h2>
          <p class="text-sm text-muted-foreground">Handpicked stories to keep the inspiration flowing.</p>
        </div>
        <a href="{% url 'web:blog-list' %}" class="inline-flex items-center gap-2 self-start rounded-full border border-transparent px-4 py-2 text-sm font-semibold text-primary transition-colors hover:text-primary/80 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-primary">
          <span>View all stories</span>
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" class="h-4 w-4">
            <path stroke-linecap="round" stroke-linejoin="round" d="m9 5 7 7-7 7" />
          </svg>
        </a>
      </div>
      <div class="grid gap-6 md:grid-cols-3">
        {% for post in related_posts %}
        <article class="overflow-hidden rounded-xl border border-border bg-card shadow-sm">
          <a href="{{ post.url }}" class="flex h-full flex-col">
            {% if post.image_url %}
            <img src="{{ post.image_url }}" alt="{{ post.title }}" class="h-48 w-full object-cover" />
            {% else %}
            <div class="flex h-48 w-full items-center justify-center bg-muted text-muted-foreground">
              <span class="text-xs font-semibold uppercase tracking-wide">Image coming soon</span>
            </div>
            {% endif %}
            <div class="flex flex-1 flex-col gap-3 p-4 text-sm">
              {% if post.category %}
              <span class="text-xs uppercase tracking-wide text-muted-foreground">{{ post.category }}</span>
              {% endif %}
              <h3 class="font-semibold text-foreground">{{ post.title }}</h3>
              {% if post.excerpt %}
              <p class="text-muted-foreground">{{ post.excerpt }}</p>
              {% endif %}
              <div class="mt-auto inline-flex items-center gap-2 text-primary">
                <span class="text-sm font-semibold">{{ post.cta_label }}</span>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" class="h-4 w-4">
                  <path stroke-linecap="round" stroke-linejoin="round" d="m9 5 7 7-7 7" />
                </svg>
              </div>
            </div>
          </a>
        </article>
        {% endfor %}
      </div>
    </div>
  </section>
  {% endif %}
</article>
{% endblock %}
